もちろん！現在の進捗と将来の展開を踏まえて、**QR問診システム全体の技術ロードマップ**を整理しました。フェーズ別・目的別に明確にしてあります。

---

# 🗺️ QR問診システム開発ロードマップ（2025年7月時点）

---

## ✅ フェーズ1：**input-app（フロントエンド）実装と整合性確認** ← ✅ 完了

| 項目                           | 状態 | 補足                            |
| ---------------------------- | -- | ----------------------------- |
| ステップUI構築（5画面構成）              | ✅  | 完了済み                          |
| テンプレートに基づくフォーム描画             | ✅  | 条件付き表示対応済み                    |
| 回答バリデーション（全type対応）           | ✅  | validationRegex, min/max 対応済み |
| 画像タップ入力（coordinate型）         | ✅  | ベクトル保存形式で対応済み                 |
| 回答CSV化 → Shift\_JIS → zlib圧縮 | ✅  | QRサイズ制限付き                     |
| 公開鍵取得 + RSA暗号化               | ✅  | fetch + RSA-OAEP構成に切替予定       |
| QRコード出力（Base64）              | ✅  | 画像保存なし・表示のみ                   |
| ログ送信API                      | ✅  | 204 / {status: ok} 検証済み       |
| fetchタイムアウト処理                | ✅  | AbortController導入済み           |
| 仕様書との整合性レビュー                 | ✅  | Codex + 手動で検証完了               |

---

## 🔄 フェーズ2：**Azure側API（Functions）実装**

| サービス                     | 実装内容                               | 優先度   |
| ------------------------ | ---------------------------------- | ----- |
| `GET /api/public-key`    | Key Vault からRSA公開鍵を取得して返却          | ⭐最優先  |
| `GET /api/templates/:id` | ストレージからテンプレートJSONを返す               | ⭐最優先  |
| `POST /api/logs`         | 受け取ったログをLog AnalyticsまたはStorageに保存 | ⭐最優先  |
| `Key Vault` 接続           | 秘密鍵・公開鍵を安全に管理                      | ⭐最優先  |
| `CORS設定`                 | input-appからAPI呼び出しを許可              | ⭐最優先  |
| `.env`切替対応               | dev/staging/prod でAPI先切替           | 🟠中優先 |
| エラーレスポンス形式の統一            | 例外時の JSONエラー返却構造を定義                | 🟡任意  |

---

## ☁️ フェーズ3：**Azureインフラ構築と本番準備**

| 対象                             | 内容                | 優先度      |
| ------------------------------ | ----------------- | -------- |
| Azure Static Web Apps          | input-app のホスティング | ✅ 構成済み想定 |
| Azure Functions デプロイ           | 3 APIエンドポイント      | ⭐最優先     |
| Azure Key Vault                | 秘密鍵登録・アクセス制限      | ⭐最優先     |
| Azure Log Analytics or Storage | ログの保存先として接続       | 🟠中優先    |
| Front Door + WAF（任意）           | ドメインとセキュリティ制御     | 🟡任意     |

---

## 🧪 フェーズ4：**ステージング環境 + E2Eテスト**

| 項目          | 内容                                           |
| ----------- | -------------------------------------------- |
| ステージング環境構築  | Static Web Apps + Functions + Vaultを dev用構成で |
| テスト用テンプレート  | 疑似問診データで動作確認                                 |
| QRコード出力チェック | 実際にスマホで読み取り可能か                               |
| ペイロード圧縮テスト  | バイト数ギリギリで生成可能か確認                             |
| ログ出力の追跡     | Azure上に記録されていることを確認                          |

---

## 🚀 フェーズ5：**本番運用 & 拡張フェーズ**

| 項目           | 内容                                 |
| ------------ | ---------------------------------- |
| 医療機関ネットワーク統合 | 院内復元アプリと連携（QR読取→復号）                |
| APIログの集計と可視化 | Log Analytics上でエラーや件数を確認           |
| ローカル保存機能     | StorageService.ts の利用による一時保存対応（任意） |
| 診療科別テンプレ管理UI | テンプレート作成・更新をGUIで可能にする              |
| 多言語対応        | JSONテンプレのi18n展開など                  |

---

## 📘 ドキュメント整備タスク（随時）

| ドキュメント                            | 状態                     |
| --------------------------------- | ---------------------- |
| `input-app-blueprint.md`（設計書）     | ✅ 完成済み                 |
| `input_app_checklist.md`（整合性チェック） | ✅ 運用中                  |
| `API仕様書.md`                       | 🟡 作成中（Functions設計の土台） |
| `README.md` + `.env.example`      | 🟠 コメント補強推奨            |
| `開発ロードマップ.md`（この文書）               | ✅ 最新化済み（今）             |

---